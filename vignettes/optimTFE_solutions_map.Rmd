---
title: "Interactive solution map"
author: "Lucas Berio Fortini"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Interactive solution map}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```
## Introduction
This vignette will demonstrate how to create a leaflet application to display
conservation footprints generated from the optimTFE algorithm.
We will use the solutions output generated from the algorithm, and then additional
spatial data of interest.
There is an option to generate an html document for sharing the map.

```{r Prep, echo=TRUE, warning=FALSE, message=FALSE}
knitr::opts_chunk$set(warning = FALSE)
# Load libraries
library(optimTFE)
library(sf)
library(dplyr)
library(tidyverse)
library(leaflet)
library(leaflet.providers)
library(htmltools)
library(htmlwidgets)
```

## Bring in datasets
Datasets to create the solution map include the solutions output,planning unit polygon data,
and additional auxiliary layers such conservation lands, maps of native or invasive habitat, etc.
We can also map selected units of individual species in the map using the solutions output.
```{r Setup datasets, echo=FALSE}

# enter the filepath to "solutions.csv" generated from the optimTFE algorithm
solution_file <- read.csv(system.file("extdata", "example_solution_file.csv", package = "optimTFE"), header = T)
# .csv with all solution results; directory set in optimTFE.Rmd example line 60

PU_polygons <- read_sf(system.file("extdata", "units_spp_suit.gpkg", package = "optimTFE")) #spatial data with PU ids and species scores

native_cons_lands <- list(
  list(name = "Native habitat", filename = system.file("extdata", "native_habitat.shp", package = "optimTFE"), hidden = T),
  list(name = "Conservation lands", filename = system.file("extdata", "reserves.shp", package = "optimTFE"), hidden=T))
map_spp <- list(
  list(species = "sp_08", hidden=T),
  list(species = "sp_12", hidden=T),
  list(species = "sp_29", hidden=T)
)

```

```{r Create a conservation footprint map, echo=TRUE, fig.width=8.25, fig.height=6, fig.show='asis'}
# Solution 100 showing conservation footprint; set solution number.
create_solution_interactive_map(solution_file, PU_polygons, selected_sol_index=21)

# Solution 53 showing conservation footprint with auxiliary layers
create_solution_interactive_map(solution_result_file = solution_file, original_PU_polygons = PU_polygons, selected_sol_index=21, map_individual_spp = map_spp,  save_HTML_loc = file.path("C:/optimTFE", "footprint21.html"))

create_solution_interactive_map(solution_file, PU_polygons, selected_sol_index=21, auxiliaryLayers = native_cons_lands, map_individual_spp = map_spp, save_HTML_loc = file.path("C:/optimTFE", "footprint21.html"))
```

